<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
	  <!-- Global site tag (gtag.js) - Google Analytics -->
	<script async src="https://www.googletagmanager.com/gtag/js?id=UA-155758577-1"></script>
	<script>
	  window.dataLayer = window.dataLayer || [];
	  function gtag(){dataLayer.push(arguments);}
	  gtag('js', new Date());
	  gtag('config', 'UA-155758577-1');
	</script>
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <title>{{_('Carculator : Start')}}</title>
    <!-- Favicon -->
    <link rel="shortcut icon" type="image/icon" href="static/images/logo_icon.ico"/>
    <!-- Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/all.css" rel="stylesheet">
    <!-- Line icon -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/simple-line-icons/2.4.1/css/simple-line-icons.css">

    <!-- Theme color -->
    <link id="switcher" href="static/css/theme-color/default-theme.css" rel="stylesheet">
	  <!-- Source Code pro font -->
	  <link href='https://fonts.googleapis.com/css?family=Source+Code+Pro' rel='stylesheet' type='text/css'>
    <!-- Main Style -->
    <link href="static/css/style.css" rel="stylesheet">
	    <!-- Tool page Style -->
    <link href="static/css/tool_style.css" rel="stylesheet">
	  <!-- Bootstrap -->
    <link href="/static/css/bootstrap.min.css" rel="stylesheet">
	  <!-- Animate.css -->
	  <link href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.7.2/animate.min.css" rel="stylesheet">


    <!-- Fonts -->

    <!-- Open Sans for body font -->
	<link href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,400i,600,700,800" rel="stylesheet">
    <!-- Montserrat for Title -->
  	<link href="https://fonts.googleapis.com/css?family=Montserrat" rel="stylesheet">



    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
  </head>
  <body id="body" style="height:100%;">

  	<!-- Start Header -->
	<header id="mu-header" class="" role="banner">
		<div class="container" style="width:100%;">
			<!-- Image Logo -->
		      <a class="navbar-brand" href="#"><img src="static\images\mediumsmall.png" style="height:40px;"></a>

		</div>
		 <h1>Hi, {{ current_user.username }}!</h1>

		<div>
			{% if current_user.is_anonymous %}
				<button class="online-button"
					  style="float:right;margin:5px;background-color:transparent;color:white;border:1px solid white;"
					 onclick="window.open(" + "{{ url_for('login') }}" + ", '_blank')">{{_('Calculate')}}</button>

			{% else %}
				<button class="online-button"
					  style="float:right;margin:5px;background-color:transparent;color:white;border:1px solid white;"
					 onclick="window.open(" + "{{ url_for('logout') }}" + ", '_blank')">{{_('Calculate')}}</button>

			{% endif %}

		</div>
	</header>
	<!-- End Header -->


	<!-- Start main content -->
	<main role="main">

		<!-- Start SCOPE -->
		<section id="mu-install" style="height:100vh;">

			<div class="container">
				<div class="row">
					<div class="mu-counter-area">
						<div class="row">

							<h1>Register</h1>
								<form action="" method="post">
									{{ form.hidden_tag() }}
									<p>
										{{ form.username.label }}<br>
										{{ form.username(size=32) }}<br>
										{% for error in form.username.errors %}
										<span style="color: red;">[{{ error }}]</span>
										{% endfor %}
									</p>
									<p>
										{{ form.email.label }}<br>
										{{ form.email(size=64) }}<br>
										{% for error in form.email.errors %}
										<span style="color: red;">[{{ error }}]</span>
										{% endfor %}
									</p>
									<p>
										{{ form.password.label }}<br>
										{{ form.password(size=32) }}<br>
										{% for error in form.password.errors %}
										<span style="color: red;">[{{ error }}]</span>
										{% endfor %}
									</p>
									<p>
										{{ form.password2.label }}<br>
										{{ form.password2(size=32) }}<br>
										{% for error in form.password2.errors %}
										<span style="color: red;">[{{ error }}]</span>
										{% endfor %}
									</p>
									<p>{{ form.submit() }}</p>
								</form>


						</div>
					</div>


				</div>
			</div>

		</section>
		<!-- End SCOPE -->


	<!-- Start footer -->
	<footer id="mu-footer" role="contentinfo">
			<div class="container" style="width:100%;background-color:white;">
				<div class="row" style="width:100%;margin-top:25px;">
				  <div class="column" style="width:33.33%;float:left;text-align:center;">
					  <img src="static/images/psi_logo.svg" style="height:50px;">
				  </div>
				  <div class="column" style="width:33.33%;display: inline-block;">
					  <div class="mu-footer-area">
						  <p>&copy; {{_('Copyright')}} <a rel="nofollow" href="http://www.psi.ch">{{_('Paul Scherrer Institut')}}</a>.
							  {{_('All rights reserved')}}.</p>
					  </div>
				  </div>
				  <div class="column" style="width:33.33%;float: right;text-align:center;">
					  <img src="static/images/ecoinvent_logo.png" style="height:50px;">
				  </div>
				</div>
			</div>

	</footer>

	<meta id="session_language" data-name="{{ session['language'] }}">

	<!-- End footer -->

    <!-- jQuery library -->
    <script src="//ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min.js"></script>
	<script
		  src="https://code.jquery.com/ui/1.12.1/jquery-ui.min.js"
		  integrity="sha256-VazP97ZCwtekAsvgPBSUwPFKdrwD3unUfSGVYrahUqU="
		  crossorigin="anonymous"></script>
		<script type="text/javascript" src="static/js/i18n.js"></script>
		<script src="https://cdn.jsdelivr.net/npm/bootstrap-notify@3.1.3/bootstrap-notify.min.js"></script>
    <!-- Include all compiled plugins (below), or include individual files as needed -->



		<script>

		//  Load the JSON File
		var country_code = "";
		$.when($.ajax({
					url: "/get_language",
					dataType: 'json',
					type: 'GET',
					success : function(data) {
					   var json = data
						return json
						},
					error: function(xhr, status, error){console.log(error)}})
				).done(function(json){
					i18n.translator.add(json);
				});

			$.get("https://api.ipdata.co/?api-key=test", function (response) {
			var str = String(JSON.stringify(response["country_name"], null, 4));
			str = str.replace(/^"|"$/g, '');
				$("#country").html(str);
				$("#country_2").html(str);
				country_code = String(JSON.stringify(response["country_code"], null, 4))
				country_code = country_code.replace(/^"|"$/g, '');
			}, "jsonp");

			function get_results(){
				var country = $("#country").html();
				var data = {"year":["2020","2035", "2050"], "type":[i18n('petrol'), i18n('diesel'), i18n('electric')],
								"size":[i18n('medium')], "driving_cycle":"WLTC",
								"foreground params":{"passenger-slider":"1.5", "cargo-slider":"150", "lifetime-slider":"200 000",
								"mileage-slider":"12 000"},
								"background params": {"country":country_code, "petrol technology":"petrol", "diesel technology":"diesel",
								"battery technology":"NMC", "battery origin":"CN"}};

				var str = i18n('job_queued')
				$.notify({
					icon: '	glyphicon glyphicon-time',
					message: str
					}
					,
					{
						placement: {
							from: "top",
							align: "center"
						},
						type:'success'
					},
					{
						animate: {
							enter: 'animated bounceInDown',
							exit: 'animated bounceOutUp'
						},

					});

				$.when($.ajax({
							url: "/get_results/",
							type: 'POST',
							data:JSON.stringify(data),
							contentType: "application/json",
							dataType: 'json',
							success : function(json) {
							   var response = json
								return response
								},
							error: function(xhr, status, error){console.log(error)}})
						).then(function (response) {
					var job_id = response['job id'];
					// Check task status every 3 seconds
					const interval = setInterval(function() {
						$.ajax('/check_status/'+job_id).then(function (status) {
							return status;
							}).then(function (status) {
								if (status['job status'] == 'finished'){
									var redirectWindow = window.open('/display_result/'+job_id, '_blank');
									redirectWindow.location;
									clearInterval(interval);
									return;
								}
								if (status['job status'] == 'job not found'){
								var str = i18n('job_lost')
									$.notify({
										icon: '	glyphicon glyphicon-warning',
										message: str
										},
										{
											placement: {
												from: "top",
												align: "center"
											},
											type:'danger'
										},
										{
											animate: {
												enter: 'animated bounceInDown',
												exit: 'animated bounceOutUp'
											},

										});

									return;
								}

								})
					 }, 3000);
				});

				var str = i18n('popup_blocker')
				$.notify({
					icon: '	glyphicon glyphicon-time',
					message: str
					}
					,
					{
						placement: {
							from: "top",
							align: "center"
						},
						type:'warning'
					},
					{
						animate: {
							enter: 'animated bounceInDown',
							exit: 'animated bounceOutUp'
						},

					});
			};
		</script>
  </body>
</html>
